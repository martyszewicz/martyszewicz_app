{% extends "battleships/base.html" %}
{% load static %}

{% block body %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<script>
   let gameMode = 'multiPlayer'
</script>
<script src="{% static 'battleships/battleships.js' %}" charset="utf-8"></script>

<div class="container">
    <div class="battleship-grid grid-user"></div>
    <div class="battleship-grid grid-computer"></div>
</div>

<div class="container hidden-info">
    <div class="setup-buttons" id="setup-buttons">
        <button id="start" class="btn">Start Game</button>
        <button id="rotate" class="btn">Rotate Your Ships</button>
    </div>
    <h3 id="whose-go" class="info-text">Your Go</h3>
    <h3 id="info" class="info-text"></h3>
</div>

<div class="container">
    <div class="grid-display">
        <div class="ship destroyer-container" draggable="true"><div id="destroyer-0"></div><div id="destroyer-1"></div></div>
        <div class="ship submarine-container" draggable="true"><div id="submarine-0"></div><div id="submarine-1"></div><div id="submarine-2"></div></div>
        <div class="ship cruiser-container" draggable="true"><div id="cruiser-0"></div><div id="cruiser-1"></div><div id="cruiser-2"></div></div>
        <div class="ship battleship-container" draggable="true"><div id="battleship-0"></div><div id="battleship-1"></div><div id="battleship-2"></div><div id="battleship-3"></div></div>
        <div class="ship carrier-container" draggable="true"><div id="carrier-0"></div><div id="carrier-1"></div><div id="carrier-2"></div><div id="carrier-3"></div><div id="carrier-4"></div></div>
    </div>
</div>

<div class="container">
    <form id="chat-form">
        <div class="form-group">
            <label for="chat-text" class="h4 pt-5">Chat</label>
            <textarea class="form-control" id="chat-text" rows="10" readonly></textarea><br>
        </div>
        <div class="form-group">
            <input class="form-control" id="input" type="text"><br>
        </div>
        <input class="btn btn-secondary btn-lg gtn-block" id="submit" type="button" value="Send">
    </form>
</div>

<button type="button" class="btn btn-primary" onclick="window.location.href='{% url 'home' %}'">Main menu</button>

{{ room_name|json_script:"room-name" }}
{{ username|json_script:"user_username" }}
<!--<script>-->
<!--    const user_username = JSON.parse(document.getElementById('user_username').textContent);-->
<!--    const roomName = JSON.parse(document.getElementById('room-name').textContent);-->
<!--    const chatTextDom = document.querySelector('#chat-text');-->
<!--    const infoMessageDom = document.querySelector('#info-message');-->

<!--    const languagePath = window.location.pathname.split('/')[1];-->
<!--    const gameSocket = new WebSocket(-->
<!--        'ws://' +-->
<!--        window.location.host +-->
<!--        '/' + languagePath +-->
<!--        '/ws/battleships/multi_player/' +-->
<!--        roomName +-->
<!--        '/'-->
<!--    );-->

<!--    document.querySelector('#chat-form').onsubmit = function (e) {-->
<!--        e.preventDefault();-->
<!--            const messageInputDom = document.querySelector('#input');-->
<!--            const message = messageInputDom.value.trim();-->

<!--            if (message !== '') {-->
<!--                gameSocket.send(JSON.stringify({-->
<!--                    'message': message,-->
<!--                    'username': user_username,-->
<!--                }));-->
<!--                messageInputDom.value = '';-->
<!--            }-->
<!--        };-->



<!--    document.querySelector('#submit').onclick = function (e) {-->
<!--            const messageInputDom = document.querySelector('#input');-->
<!--            const message = messageInputDom.value.trim();-->

<!--            if (message !== '') {-->
<!--                gameSocket.send(JSON.stringify({-->
<!--                    'message': message,-->
<!--                    'username': user_username,-->
<!--                }));-->
<!--                messageInputDom.value = '';-->
<!--            }-->
<!--        };-->


<!--    gameSocket.onmessage = function (e) {-->
<!--        const data = JSON.parse(e.data);-->
<!--        if (data.type === 'chat_message') {-->
<!--            document.querySelector('#chat-text').value += (data.username + ': ' + data.message + '\n');-->
<!--            chatTextDom.scrollTop = chatTextDom.scrollHeight;-->
<!--        } else if (data.type === 'system_message') {-->
<!--            infoMessageDom.style.display = 'block';-->
<!--            infoMessageDom.innerText = data.message;-->
<!--        }-->
<!--    };-->

<!--</script>-->
{% endblock %}